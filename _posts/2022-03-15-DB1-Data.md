---
layout: article
title:  "DB1æ•°æ®"
date:   2022-03-15
categories: æœºå™¨å­¦ä¹ 
tags: [æœºå™¨å­¦ä¹ ,sEMG,åˆ†ç±»å™¨]
---

## æ•°æ®é›†ä¸‹è½½

ä¸‹è½½æ•°æ®é›†http://153.109.124.99/node/241

### H5PYä¿å­˜ä¸è¯»å–

```PYTHON
import h5py
X= np.random.rand(100, 1000, 1000).astype('float32')
y = np.random.rand(1, 1000, 1000).astype('float32')

# Create a new file
f = h5py.File('data.h5', 'w')
f.create_dataset('X_train', data=X)
f.create_dataset('y_train', data=y)
f.close()

# Load hdf5 dataset
f = h5py.File('data.h5', 'r')
X = f['X_train']
Y = f['y_train']
f.close()

```

## è¾“å‡ºDB1ç›¸å…³çš„æ•°æ®

```python
    file = h5py.File('data/DB1_S1_image.h5', 'r')
    imageData = file['imageData'][:]
    imageLabel = file['imageLabel'][:]
    
	print(file.keys())
	
	file.close()
	
	

    print(imageData.shape)
    print(imageData)
    print(type(imageData))
    print(imageData[0])
    print(imageData[0][0])
    print(imageLabel.shape)
    print(imageLabel)
    print(type(imageLabel))
    print(imageLabel[0])
```

è¿”å›

```BASH
# DB1æ•°æ®é›†å…±52ä¸ªä¸åŒåŠ¨ä½œï¼Œ10æ¬¡é‡å¤
# è¾“å‡ºDB1éƒ½æœ‰å“ªäº›æ•°æ®
<KeysViewHDF5 ['imageData', 'imageLabel']>
# è‚Œç”µ15047ä¸ªï¼Œ10åˆ—ï¼Œ12è¡Œ
# ä½¿ç”¨ 10 ä¸ª Otto Bock MyoBock 13E200 ç”µæè·å– sEMG æ•°æ®ï¼Œå¾—åˆ°äº†è¿ç»­çš„10è¡ŒsEMG
# æ´»åŠ¨æ®µçš„ä¿¡å·ä¸­è¿ç»­é‡‡æ ·12æ¬¡
(15047, 12, 10)
[[[0.0171 0.0073 0.0024 ... 0.0317 0.0024 0.0146]
  [0.0171 0.0244 0.0024 ... 0.0342 0.0024 0.0146]
  [0.0146 0.0269 0.0024 ... 0.0342 0.0024 0.0146]
  ...
  [0.0195 0.0049 0.0024 ... 0.0854 0.0024 0.022 ]
  [0.0269 0.0049 0.0024 ... 0.0806 0.0024 0.0146]
  [0.0342 0.0171 0.0024 ... 0.0781 0.0024 0.0098]]

 [[0.0391 0.0171 0.0024 ... 0.0732 0.0024 0.0049]
  [0.0488 0.0146 0.0024 ... 0.0659 0.0024 0.0024]
  [0.0464 0.0122 0.0024 ... 0.061  0.0024 0.0024]
  ...
  [0.0391 0.1538 0.0049 ... 0.0464 0.0806 0.0098]
  [0.0317 0.1367 0.0024 ... 0.0415 0.0806 0.0073]
  [0.0317 0.1123 0.0024 ... 0.0439 0.0732 0.0049]]

 [[0.0269 0.0928 0.0024 ... 0.0439 0.0586 0.0024]
  [0.0244 0.0708 0.0024 ... 0.0439 0.0488 0.0024]
  [0.022  0.0537 0.0122 ... 0.0464 0.0366 0.0024]
  ...
  [0.0293 0.022  0.0024 ... 0.0415 0.0269 0.0024]
  [0.0366 0.0684 0.0049 ... 0.0439 0.0952 0.0024]
  [0.0366 0.1001 0.0024 ... 0.0439 0.1465 0.0024]]

 ...

 [[0.0073 0.0024 0.0024 ... 0.1611 0.1611 0.022 ]
  [0.0244 0.0024 0.0024 ... 0.166  0.1538 0.0244]
  [0.0391 0.0024 0.0024 ... 0.1831 0.1465 0.0293]
  ...
  [0.1025 0.0024 0.0024 ... 0.144  0.1172 0.3101]
  [0.1563 0.0024 0.0024 ... 0.1514 0.1196 0.4077]
  [0.1758 0.0024 0.0024 ... 0.1514 0.1221 0.4663]]

 [[0.1709 0.0024 0.0049 ... 0.1855 0.1196 0.5029]
  [0.1538 0.0024 0.0024 ... 0.2075 0.1172 0.52  ]
  [0.1611 0.0024 0.0024 ... 0.2368 0.1123 0.5273]
  ...
  [0.2539 0.0024 0.0024 ... 0.293  0.1636 0.2612]
  [0.3101 0.0024 0.0024 ... 0.3101 0.1733 0.2393]
  [0.3516 0.0024 0.0024 ... 0.3247 0.1758 0.2271]]

 [[0.3442 0.0024 0.0024 ... 0.3223 0.188  0.2173]
  [0.3784 0.0024 0.0024 ... 0.3101 0.1953 0.1978]
  [0.3857 0.0024 0.0024 ... 0.3003 0.1978 0.1929]
  ...
  [0.481  0.0024 0.0024 ... 0.2832 0.2075 0.2026]
  [0.4883 0.0024 0.0024 ... 0.2734 0.1953 0.2417]
  [0.4907 0.0024 0.0024 ... 0.2734 0.1782 0.2686]]]
<class 'numpy.ndarray'>
# DB1æ•°æ®çš„ç¬¬ä¸€ä¸ªçŸ©é˜µ
# 10åˆ—ï¼Œ12è¡Œ
[[0.0171 0.0073 0.0024 0.0024 0.0024 0.0024 0.0757 0.0317 0.0024 0.0146]
 [0.0171 0.0244 0.0024 0.0024 0.0024 0.0024 0.0684 0.0342 0.0024 0.0146]
 [0.0146 0.0269 0.0024 0.0024 0.0024 0.0024 0.061  0.0342 0.0024 0.0146]
 [0.022  0.0195 0.0024 0.0024 0.0024 0.0024 0.0513 0.0366 0.0024 0.0098]
 [0.0269 0.0171 0.0024 0.0024 0.0024 0.0024 0.0488 0.0415 0.0024 0.0073]
 [0.0269 0.0293 0.0024 0.0024 0.0024 0.0024 0.0732 0.0488 0.0024 0.0073]
 [0.0244 0.0317 0.0024 0.0024 0.0024 0.0024 0.1001 0.0635 0.0024 0.0098]
 [0.022  0.0244 0.0024 0.0024 0.0024 0.0024 0.1074 0.0757 0.0024 0.0195]
 [0.0171 0.0146 0.0024 0.0024 0.0024 0.0024 0.1172 0.0854 0.0024 0.022 ]
 [0.0195 0.0049 0.0024 0.0024 0.0024 0.0024 0.1147 0.0854 0.0024 0.022 ]
 [0.0269 0.0049 0.0024 0.0024 0.0024 0.0024 0.1147 0.0806 0.0024 0.0146]
 [0.0342 0.0171 0.0024 0.0024 0.0024 0.0024 0.1221 0.0781 0.0024 0.0098]]
# çŸ©é˜µçš„ä¸€è¡Œ10åˆ—sEMGæ•°æ®
[0.0171 0.0073 0.0024 0.0024 0.0024 0.0024 0.0757 0.0317 0.0024 0.0146]
# æ ‡ç­¾15047ä¸ª
(15047,)
# åˆ†åˆ«å¯¹åº”sEMGçš„æ ‡ç­¾
[ 0  0  0 ... 51 51 51]
<class 'numpy.ndarray'>
# ç¬¬ä¸€ä¸ªæ ‡ç­¾çš„å€¼
0
```
>shapeä¸€èˆ¬æ˜¯\[ä¸ªæ•°,è¡Œæ•°,åˆ—æ•°]

### æ‰“ä¹±æ ‡ç­¾ï¼Œå¹¶ä¸”é™ç»´
```python
    # éšæœºæ‰“ä¹±æ•°æ®å’Œæ ‡ç­¾
    N = imageData.shape[0]
    index = np.random.permutation(N)
    print(N)
    print(type(index))
    print(index)
    data = imageData[index, :, :]
    label = imageLabel[index]
    print(label.shape)
    print(label)

    # å¯¹æ•°æ®å‡ç»´,æ ‡ç­¾one-hot
    # data  = np.expand_dims(data, axis=3)
    label = convert_to_one_hot(label, 52).T

    print(type(label))
    print(label)

    # åˆ’åˆ†æ•°æ®é›†
    N = data.shape[0]
    num_train = round(N * 0.8)
    X_train = data[0:num_train, :, :]
    Y_train = label[0:num_train, :]
    X_test = data[num_train:N, :, :]
    Y_test = label[num_train:N, :]



    print("X_train shape: " + str(X_train.shape))
    print("Y_train shape: " + str(Y_train.shape))
    print("X_test shape: " + str(X_test.shape))
    print("Y_test shape: " + str(Y_test.shape))

    f=h5py.File('DB1_data.h5')
    X_train=f['X_train']
    Y_train = f['Y_train']

    print(X_train[0])
    print(X_train.shape)
    print(Y_train[0])
    print(Y_train.shape)

    model = keras.models.load_model('DB1_TextCNN.h5')
```

è¿”å›

```BASH
# è¾“å‡ºæ ‡ç­¾çš„shape[0]
15047
<class 'numpy.ndarray'>
# æ‰“ä¹±sEMGçš„çŸ©é˜µä¸ªæ•°
[ 8426  7259 13056 ...  9946 13291  9543]
# è¾“å‡ºshape
(15047,)
# å…¶ä¸­dataçš„æ ¹æ®indexç´¢å¼•é…å¯¹çš„å€¼ï¼Œåˆ›å»ºæ‰“ä¹±æ ‡ç­¾çš„sEMGåˆ—è¡¨
# labelçš„æ ‡ç­¾ä¹Ÿè¢«æ‰“ä¹±
[31 28 46 ... 36 47 35]
<class 'numpy.ndarray'>
# å‡ç»´ï¼Œä¸€å¯¹å¤š
[[0. 0. 0. ... 0. 0. 0.]
 [0. 0. 0. ... 0. 0. 0.]
 [0. 0. 0. ... 0. 0. 0.]
 ...
 [0. 0. 0. ... 0. 0. 0.]
 [0. 0. 0. ... 0. 0. 0.]
 [0. 0. 0. ... 0. 0. 0.]]
# è¾“å‡ºh5çš„shape
X_train shape: (12038, 12, 10)
Y_train shape: (12038, 52)
X_test shape: (3009, 12, 10)
Y_test shape: (3009, 52)

# è¾“å‡ºX_train[0]ç¬¬0ä¸ªçŸ©é˜µçš„sEMGæ•°æ®
[[0.3101 0.2026 0.5396 0.0122 0.0635 0.144  0.6689 0.4956 0.1563 0.1245]
 [0.3296 0.2124 0.5469 0.0098 0.061  0.144  0.7251 0.4614 0.1733 0.127 ]
 [0.354  0.2344 0.5908 0.0073 0.0586 0.144  0.769  0.4321 0.1733 0.1245]
 [0.3784 0.249  0.5664 0.0049 0.0537 0.144  0.8179 0.459  0.1685 0.127 ]
 [0.4126 0.2588 0.5884 0.0098 0.0537 0.1392 0.8789 0.5835 0.1587 0.1392]
 [0.4639 0.2734 0.5908 0.0195 0.0537 0.1318 0.8838 0.6445 0.1514 0.1489]
 [0.4688 0.3003 0.6006 0.0269 0.0537 0.1392 0.9277 0.6836 0.1709 0.1514]
 [0.4761 0.3003 0.6177 0.0317 0.0513 0.1392 0.9277 0.708  0.1807 0.1465]
 [0.4858 0.293  0.6006 0.0317 0.0513 0.1367 0.896  0.7349 0.1733 0.1318]
 [0.5103 0.2832 0.5518 0.0293 0.0488 0.1489 0.874  0.7422 0.1611 0.1318]
 [0.5835 0.2734 0.5225 0.0269 0.0488 0.1636 0.8496 0.73   0.1465 0.1514]
 [0.6226 0.271  0.5933 0.022  0.0439 0.1733 0.8472 0.686  0.1343 0.1538]]
# è¾“å‡ºX_trainçš„shape
(12038, 12, 10)
# è¾“å‡ºå¯¹åº”çš„æ ‡ç­¾
[0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 1. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
# è¾“å‡ºå¯¹åº”çš„shape
(12038, 52)
2022-04-07 14:20:39.670594: I tensorflow/core/platform/cpu_feature_guard.cc:142] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX AVX2
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2022-04-07 14:20:40.266327: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 4628 MB memory:  -> device: 0, name: NVIDIA GeForce GTX 1060, pci bus id: 0000:01:00.0, compute capability: 6.1

è¿›ç¨‹å·²ç»“æŸ,é€€å‡ºä»£ç 0

```

### æ ‡ç­¾åˆ›å»º0ne-hotå½¢å¼çš„æ•°ç»„

å¦‚\[1,2,3...52]çš„ç¬¬ä¸€ä¸ª1çš„æ ‡ç­¾åˆ›å»º\[1,0,0...0]ï¼Œç¬¬äºŒä¸ªçš„2åˆ›å»º\[0,2,0...0]æ¥è¡¨ç¤º

```python
Y=np.array([5,1,4,3,2,1])

print(np.eye(6))
print(np.eye(6)[Y.reshape(-1)])
print(np.eye(6)[Y.reshape(-1)].T)
```
è¿”å›
```
# åˆ›å»ºå¯¹è§’çŸ©é˜µ
[[1. 0. 0. 0. 0. 0.]
 [0. 1. 0. 0. 0. 0.]
 [0. 0. 1. 0. 0. 0.]
 [0. 0. 0. 1. 0. 0.]
 [0. 0. 0. 0. 1. 0.]
 [0. 0. 0. 0. 0. 1.]]
 
# æ ‡ç­¾å¯¹åº”çš„çŸ©é˜µ
[[0. 0. 0. 0. 0. 1.]
 [0. 1. 0. 0. 0. 0.]
 [0. 0. 0. 0. 1. 0.]
 [0. 0. 0. 1. 0. 0.]
 [0. 0. 1. 0. 0. 0.]
 [0. 1. 0. 0. 0. 0.]]
# è½¬ç½®
 [[0. 0. 0. 0. 0. 0.]
 [0. 1. 0. 0. 0. 1.]
 [0. 0. 0. 0. 1. 0.]
 [0. 0. 0. 1. 0. 0.]
 [0. 0. 1. 0. 0. 0.]
 [1. 0. 0. 0. 0. 0.]]
```

### sEMGæ•°æ®å¯¹åº”çš„æ ‡ç­¾

æ¯”å¦‚è¯´æŸä¸ª10åˆ—12è¡Œçš„è‚Œç”µæ•°æ®ï¼š
```
[[0.3101 0.2026 0.5396 0.0122 0.0635 0.144  0.6689 0.4956 0.1563 0.1245]
 [0.3296 0.2124 0.5469 0.0098 0.061  0.144  0.7251 0.4614 0.1733 0.127 ]
 [0.354  0.2344 0.5908 0.0073 0.0586 0.144  0.769  0.4321 0.1733 0.1245]
 [0.3784 0.249  0.5664 0.0049 0.0537 0.144  0.8179 0.459  0.1685 0.127 ]
 [0.4126 0.2588 0.5884 0.0098 0.0537 0.1392 0.8789 0.5835 0.1587 0.1392]
 [0.4639 0.2734 0.5908 0.0195 0.0537 0.1318 0.8838 0.6445 0.1514 0.1489]
 [0.4688 0.3003 0.6006 0.0269 0.0537 0.1392 0.9277 0.6836 0.1709 0.1514]
 [0.4761 0.3003 0.6177 0.0317 0.0513 0.1392 0.9277 0.708  0.1807 0.1465]
 [0.4858 0.293  0.6006 0.0317 0.0513 0.1367 0.896  0.7349 0.1733 0.1318]
 [0.5103 0.2832 0.5518 0.0293 0.0488 0.1489 0.874  0.7422 0.1611 0.1318]
 [0.5835 0.2734 0.5225 0.0269 0.0488 0.1636 0.8496 0.73   0.1465 0.1514]
 [0.6226 0.271  0.5933 0.022  0.0439 0.1733 0.8472 0.686  0.1343 0.1538]]
 ```
å¯¹åº”33çš„æ ‡ç­¾
```
[0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 1. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
 ```

#### np.expand_dims(data, axis=int)å¢åŠ æˆ–ä¿®æ”¹æ•°æ®ç»´åº¦

`data.shape = ï¼ˆ28ï¼Œ28ï¼Œ1ï¼‰`
axis = 0æ—¶ï¼šï¼ˆ28ï¼Œ28ï¼Œ1ï¼‰ğŸ”œ ï¼ˆ1ï¼Œ28ï¼Œ28ï¼Œ1ï¼‰
axis = 1æ—¶ï¼šï¼ˆ28ï¼Œ28ï¼Œ1ï¼‰ğŸ”œ ï¼ˆ28ï¼Œ1ï¼Œ28ï¼Œ1ï¼‰
axis = -1æ—¶ï¼šï¼ˆ28ï¼Œ28ï¼Œ1ï¼‰ğŸ”œ ï¼ˆ28ï¼Œ28ï¼Œ1ï¼Œ1ï¼‰

#### for

for xx in range(len(xxx))

### è¾“å‡ºå›¾åƒ

```PYTHON
import matplotlib.pyplot as plt 
# plt.imshow(xxxæ•°ç»„)
plt.imshow(xxxæ•°ç»„,interpolation='nearest',cmap='bone',origin='upper')
plt.colorbar(shrink=0.5)#shrinkæ§åˆ¶barçš„é•¿åº¦
plt.xticks(())
plt.yticks(())
plt.show()
```

### è¾“å‡ºé¢„æµ‹å€¼

```PYTHON
model=keras.models.load_model('xxxx.h5')
output=model.predict(xxxx)
# æˆ– output=model(xxx)


# å–æ¶ˆç§‘å­¦è®¡æ•°æ³•è¾“å‡º
np.set_printoptions(suppress=True)

# è¾“å‡ºé¢„æµ‹å€¼
output=np.argmax(output,axis=1)
print(output)


```

### å¯¹æ•°æ®è¿›è¡Œå‡é™ç»´

```PYTHON
x=np.array([xxx])

x.reshape(x,x,x)

a=np.array([[1],[2],[3]])

# é™ç»´
a=a.reshape(-1)
# a=[1,2,3]

# å‡ç»´
a=a.reshape(1,3)
#a=[[1,2,3]]

# å‡ç»´
a=a.reshape(1,1,3)
a=[[[1,2,3]]]

# å‡ç»´
a=a.reshape(3,1)
a=[[1],[2],[3]]
```

## S1_E1_A1.MATæ•°æ®å¤„ç†

```python
import scipy.io as scio
import matplotlib.pyplot as plt
import numpy as np
import math

import h5py
from feature import *
import math
'''
DB2è‚Œç”µæ•°æ®é›†ï¼Œä¿¡å·ä»¥2KHZé€Ÿç‡è¿›è¡Œé‡‡æ ·ï¼Œå—è¯•è€…é‡å¤49ç§ä¸åŒåŠ¨ä½œ
æ¯ä¸ªåŠ¨ä½œæŒç»­5ç§’ï¼Œä¼‘æ¯é—´éš”3ç§’

accåŒ…å«36åˆ—ï¼Œ12ä¸ªç”µæçš„ä¸‰è½´åŠ é€Ÿè®¡
emgä¸º12åˆ—ï¼Œ12ä¸ªç”µæçš„sEMGä¿¡å·
'''

def getdata():
    E1 = scio.loadmat('S1_E1_A1.mat')

    print(E1.keys())

    E1_emg = E1['emg']

    E1_label = E1['restimulus']

    index1 = []
    for i in range(len(E1_label)):
        if E1_label[i] != 0:
            index1.append(i)
    label1 = E1_label[index1, :]
    emg1 = E1_emg[index1, :]

    emg = np.vstack((emg1))
    label = np.vstack((label1))
    label = label - 1

    print(emg.shape)
    print(label.shape)
    print(label)


    plt.plot(label)
    plt.show()

    plt.plot(E1_emg[0:200000, 5] * 20000)
    plt.plot(E1_label[0:200000])



    featureData = []
    featureLabel = []
    classes = 9
    timeWindow = 200
    strideWindow = 200

    for i in range(classes):
        index = []
        for j in range(label.shape[0]):
            if (label[j, :] == i):
                index.append(j)
        iemg = emg[index, :]
        length = math.floor((iemg.shape[0] - timeWindow) / strideWindow)
        print("class ", i, ",number of sample: ", iemg.shape[0], length)

        for j in range(length):
            rms = featureRMS(iemg[strideWindow * j:strideWindow * j + timeWindow, :])
            mav = featureMAV(iemg[strideWindow * j:strideWindow * j + timeWindow, :])
            wl = featureWL(iemg[strideWindow * j:strideWindow * j + timeWindow, :])
            zc = featureZC(iemg[strideWindow * j:strideWindow * j + timeWindow, :])
            ssc = featureSSC(iemg[strideWindow * j:strideWindow * j + timeWindow, :])
            featureStack = np.hstack((rms, mav, wl, zc, ssc))

            featureData.append(featureStack)
            featureLabel.append(i)
    featureData = np.array(featureData)

    print(featureData.shape)
    print(len(featureLabel))

    from sklearn.preprocessing import MinMaxScaler

    emg = emg * 20000

    imageData = []
    imageLabel = []
    imageLength = 200
    classes = 9

    for i in range(classes):
        index = []
        for j in range(label.shape[0]):
            if (label[j, :] == i):
                index.append(j)

        iemg = emg[index, :]
        length = math.floor((iemg.shape[0] - imageLength) / imageLength)
        print("class ", i, " number of sample: ", iemg.shape[0], length)

        for j in range(length):
            subImage = iemg[imageLength * j:imageLength * (j + 1), :]
            imageData.append(subImage)
            imageLabel.append(i)

    imageData = np.array(imageData)
    print(imageData.shape)
    print(len(imageLabel))

    file = h5py.File('DB2//DB2_S1_feature_200_0.h5', 'w')
    file.create_dataset('featureData', data=featureData)
    file.create_dataset('featureLabel', data=featureLabel)
    file.close()

    file = h5py.File('DB2//DB2_S1_image_200_0.h5', 'w')
    file.create_dataset('imageData', data=imageData)
    file.create_dataset('imageLabel', data=imageLabel)
    file.close()
```

### æ‰“å°å®Œæ•´æ•°ç»„

```python
    np.set_printoptions(threshold=np.inf)
	# å–æ¶ˆæ‰“å°å®Œæ•´å­—ç¬¦æ—¶
    np.set_printoptions(threshold=False)
```